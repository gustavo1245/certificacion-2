{% extends 'base.html' %}
{% block title %}{{ plan.destination }} - Ver Asesoría{% endblock %}
{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">Ver Asesoría</h4>
                        <div>
                            <a href="/citas" class="text-white text-decoration-none">Inicio</a> |
                            <a href="/usuarios/logout" class="text-white text-decoration-none">Cerrar Sesión</a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    {% with messages = get_flashed_messages(category_filter=['error', 'success']) %}
                    {% if messages %}
                    <div class="alert alert-info">
                        {% for message in messages %}
                        <p class="mb-1">ℹ️ {{ message }}</p>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% endwith %}

                    <div class="text-center mb-4">
                        <h2 class="display-6 text-primary">{{ plan.destination or 'Spring Data' }}</h2>
                        <p class="lead text-muted">Detalles de la Asesoría</p>
                    </div>

                    <!-- Información asesoría -->
                    <div class="row">
                        <div class="col-12">
                            <div class="info-item">
                                <strong>Solicitante:</strong>
                                <span>{{ plan.autor_nombre or 'Usuario' }} {{ plan.autor_apellido or '' }}</span>
                            </div>
                            <div class="info-item">
                                <strong>Fecha de la asesoría:</strong>
                                <span>{{ plan.travel_start_date or 'No especificada' }}</span>
                            </div>
                            <div class="info-item">
                                <strong>Duración:</strong>
                                <span>2 horas</span>
                            </div>
                            <div class="info-item">
                                <strong>Notas adicionales:</strong>
                                <p class="mt-2">{{ plan.plan or 'Sin notas adicionales' }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Cambiar tutor - Solo el autor puede cambiar el tutor -->
                    {% if plan.autor_id == usuario.id %}
                    <div class="mt-4">
                        <h5>Cambiar Tutor</h5>
                        <div class="alert alert-warning border-0 mb-3">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Gestión de Tutor</strong>
                            <p class="mb-0 mt-1">Como creador de esta asesoría, puedes cambiar el tutor asignado.</p>
                        </div>
                        <form action="/citas/cambiar_tutor/{{ plan.id }}" method="post">
                            <div class="mb-3">
                                <label for="nuevo_tutor" class="form-label">Seleccionar nuevo tutor:</label>
                                <select class="form-select" name="nuevo_tutor" required>
                                    <option value="">Elige un tutor...</option>
                                    {% for tutor in tutores %}
                                    <option value="{{ tutor.id }}">{{ tutor.nombre }} {{ tutor.apellido }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <button type="submit" class="btn btn-warning">
                                <i class="fas fa-exchange-alt me-2"></i>Cambiar Tutor
                            </button>
                        </form>
                    </div>
                    {% else %}
                    <div class="mt-4">
                        <div class="alert alert-info border-0">
                            <i class="fas fa-lock me-2"></i>
                            <strong>Solo el creador puede modificar el tutor</strong>
                            <p class="mb-0 mt-1">Esta asesoría fue creada por {{ plan.autor_nombre }} {{ plan.autor_apellido }}. Solo el creador puede cambiar el tutor asignado.</p>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Botones accion -->
                    <div class="d-flex justify-content-between mt-4">
                        <a href="/citas" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Volver al Dashboard
                        </a>
                        {% if plan.autor_id == usuario.id %}
                        <div>
                            <a href="/citas/editar/{{ plan.id }}" class="btn btn-outline-primary me-2">
                                <i class="fas fa-edit me-2"></i>Editar
                            </a>
                            <a href="/citas/eliminar_plan/{{ plan.id }}" class="btn btn-outline-danger"
                                onclick="return confirm('¿Estás seguro de que quieres eliminar esta asesoría?')">
                                <i class="fas fa-trash me-2"></i>Eliminar
                            </a>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Informacion de creacion -->
                    <div class="mt-4 pt-3 border-top">
                        <small class="text-muted">
                            <i class="fas fa-calendar me-2"></i>
                            {% if plan.creado_en %}
                            <strong>Creado el:</strong>
                            <span class="text-muted">{{ plan.creado_en.strftime('%d de %B %Y') if
                                plan.creado_en.strftime else plan.creado_en }}</span>
                            {% else %}
                            <strong>Creado el:</strong>
                            <span class="text-muted">Fecha no disponible</span>
                            {% endif %}
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .info-item {
        padding: 0.75rem 0;
        border-bottom: 1px solid #eee;
    }

    .info-item:last-child {
        border-bottom: none;
    }

    .card {
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        border-radius: 10px;
    }

    .bg-warning.bg-opacity-25 {
        background-color: rgba(255, 193, 7, 0.25) !important;
    }
</style>
{% endblock %}